<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Vista de formulario para transacciones Culqi -->
        <record id="payment_transaction_form_culqi" model="ir.ui.view">
            <field name="name">payment.transaction.form.culqi</field>
            <field name="model">payment.transaction</field>
            <field name="inherit_id" ref="payment.payment_transaction_form"/>
            <field name="arch" type="xml">
                
                <!-- Agregar campos básicos de Culqi -->
                <xpath expr="//field[@name='provider_reference']" position="after">
                    <field name="culqi_token_id" readonly="1" invisible="provider_code != 'culqi'"/>
                    <field name="culqi_charge_id" readonly="1" invisible="provider_code != 'culqi'"/>
                    <field name="culqi_payment_method" readonly="1" invisible="provider_code != 'culqi'"/>
                </xpath>

                <!-- Agregar información financiera -->
                <xpath expr="//field[@name='amount']" position="after">
                    <field name="culqi_fee" readonly="1" invisible="provider_code != 'culqi' or not culqi_fee"/>
                </xpath>

                <!-- Agregar grupo de información Culqi -->
                <xpath expr="//group[@name='payment_info']" position="after">
                    <group string="Información Culqi" invisible="provider_code != 'culqi'">
                        <group>
                            <field name="culqi_token_id" readonly="1"/>
                            <field name="culqi_charge_id" readonly="1"/>
                        </group>
                        <group>
                            <field name="culqi_payment_method" readonly="1"/>
                            <field name="culqi_fee" readonly="1"/>
                        </group>
                    </group>
                </xpath>

                <!-- Botón simple para ver en Culqi (sin action que no existe) -->
                <xpath expr="//header" position="inside">
                    <button name="%(payment_culqi.action_view_culqi_panel)d" 
                            type="action" 
                            string="Ver en Culqi" 
                            class="btn-primary"
                            invisible="provider_code != 'culqi' or not culqi_charge_id"/>
                </xpath>

            </field>
        </record>

        <!-- Acción simple para abrir panel Culqi -->
        <record id="action_view_culqi_panel" model="ir.actions.act_url">
            <field name="name">Ver en Panel Culqi</field>
            <field name="url">https://panel.culqi.com/transactions</field>
            <field name="target">new</field>
        </record>

        <!-- Vista de lista simplificada -->
        <record id="payment_transaction_tree_culqi" model="ir.ui.view">
            <field name="name">payment.transaction.tree.culqi</field>
            <field name="model">payment.transaction</field>
            <field name="inherit_id" ref="payment.payment_transaction_tree"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='amount']" position="after">
                    <field name="culqi_payment_method" optional="hide"/>
                    <field name="culqi_fee" optional="hide"/>
                </xpath>
            </field>
        </record>

    </data>
</odoo>